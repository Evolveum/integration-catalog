<!-- Success Toast Notification -->
@if (submitSuccess()) {
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 2000;">
    <div style="border-radius: 8px; overflow: hidden; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); min-width: 350px;">
      <!-- Green header row -->
      <div class="d-flex justify-content-between align-items-center px-3 py-2" style="background-color: #198754; color: white;">
        <div class="d-flex align-items-center gap-2">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
          </svg>
          <strong>Request Successful!</strong>
        </div>
        <button type="button" class="btn-close btn-close-white" (click)="closeSuccessMessage()" aria-label="Close"></button>
      </div>
      <!-- Light green message row -->
      <div class="px-3 py-2" style="background-color: #d1e7dd; color: black;">
        Your request has been submitted. Our team will review it and get back to you.
      </div>
    </div>
  </div>
}

<div class="container-fluid p-0" style="background-color: #e9ecef; min-height: 100vh;">
  <div class="container-fluid px-5 py-5">
    <div class="mb-4">
      <button class="btn text-primary" (click)="goBack()" style="border: none;">
        ‚Üê Back to Integration Catalog
      </button>
    </div>

    <div class="request-form-container" style="width: 100%;">
      <div class="request-form-header" style="padding-left: 0; width: 100%;">
        <h1 style="margin-left: 0;">Integration</h1>
      </div>

      <div class="request-form-content" style="padding-left: 0;">
        <!-- Two Column Layout with Gap -->
        <div class="row g-3" style="margin-left: 0; margin-right: 0;">
          <!-- Left Column -->
          <div class="col-12 col-lg-3" style="padding-left: 0; min-width: 360px;">
            <div class="form-section" style="width: 100%;">
              <!-- Filter Header -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="filter-title mb-0">Filter By</h4>
                <button type="button" class="btn btn-clear-filters" (click)="clearFilters()">Clear Filters</button>
              </div>

              <!-- Separator Line -->
              <hr class="filter-separator">

              <!-- Filter Items -->
              <div class="filter-items">
                <div class="filter-item">
                  <span class="filter-label">App Status</span>
                  <button type="button" class="btn btn-clear-item" (click)="clearAppStatus()">Clear</button>
                </div>

                <!-- App Status Radio Buttons -->
                <div class="filter-options">
                  @for (status of appStatuses(); track status.displayName) {
                    <div class="form-check">
                      <input class="form-check-input app-status-radio" type="radio" name="appStatus" [id]="'status-' + status.displayName" [value]="status.displayName" [checked]="status.displayName === 'All'" (change)="onAppStatusChange($event)">
                      <label class="form-check-label" [for]="'status-' + status.displayName">
                        {{ status.displayName }} ({{ status.count }})
                      </label>
                    </div>
                  }
                </div>

                <!-- Toggle Filters Button -->
                <div class="d-flex justify-content-start my-3">
                  <button type="button" class="btn btn-link text-decoration-none p-0" (click)="toggleFilters()" style="color: #0d6efd; font-size: 0.95rem;">
                    {{ areFiltersExpanded() ? '- Less Filters' : '+ More Filters' }}
                  </button>
                </div>

                @if (areFiltersExpanded()) {
                <div class="filter-item" style="cursor: pointer;" (click)="toggleSupportedOperations()">
                  <span class="filter-label">Supported Operations</span>
                  <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-clear-item" (click)="clearSupportedOperations(); $event.stopPropagation()">Clear</button>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" [style.transform]="isSupportedOperationsExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'" style="transition: transform 0.2s;">
                      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                  </div>
                </div>

                <!-- Supported Operations Checkboxes -->
                @if (isSupportedOperationsExpanded()) {
                  <div class="filter-options">
                    @for (operation of supportedOperations(); track operation.displayName) {
                      <div class="form-check-checkbox">
                        <input class="form-check-input-checkbox supported-operations-checkbox" type="checkbox" [id]="'op-' + operation.displayName" [value]="operation.displayName" (change)="onSupportedOperationChange($event, operation.displayName)">
                        <label class="form-check-label-checkbox" [for]="'op-' + operation.displayName">
                          {{ operation.displayName }} ({{ operation.count }})
                        </label>
                      </div>
                    }
                  </div>
                }

                <div class="filter-item" style="cursor: pointer;" (click)="toggleCategory()">
                  <span class="filter-label">Category</span>
                  <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-clear-item" (click)="clearCategory(); $event.stopPropagation()">Clear</button>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" [style.transform]="isCategoryExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'" style="transition: transform 0.2s;">
                      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                  </div>
                </div>

                <!-- Category Checkboxes -->
                @if (isCategoryExpanded()) {
                  <div class="filter-options">
                    @for (category of categories(); track category.displayName) {
                      <div class="form-check-checkbox">
                        <input class="form-check-input-checkbox category-checkbox" type="checkbox" [id]="'cat-' + category.displayName" [value]="category.displayName" (change)="onCategoryChange($event, category.displayName)">
                        <label class="form-check-label-checkbox" [for]="'cat-' + category.displayName">
                          {{ category.displayName }} ({{ category.count }})
                        </label>
                      </div>
                    }
                  </div>
                }

                <div class="filter-item" style="cursor: pointer;" (click)="toggleCertificationLevel()">
                  <span class="filter-label">Certification Level</span>
                  <div class="d-flex align-items-center gap-2">
                    <button type="button" class="btn btn-clear-item" (click)="clearCertificationLevel(); $event.stopPropagation()">Clear</button>
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" [style.transform]="isCertificationLevelExpanded() ? 'rotate(90deg)' : 'rotate(0deg)'" style="transition: transform 0.2s;">
                      <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
                    </svg>
                  </div>
                </div>

                <!-- Certification Level Checkboxes -->
                @if (isCertificationLevelExpanded()) {
                  <div class="filter-options">
                    @for (certLevel of certificationLevels(); track certLevel.displayName) {
                      <div class="form-check-checkbox">
                        <input class="form-check-input-checkbox certification-checkbox" type="checkbox" [id]="'cert-' + certLevel.displayName" [value]="certLevel.displayName" (change)="onCertificationLevelChange($event, certLevel.displayName)">
                        <label class="form-check-label-checkbox" [for]="'cert-' + certLevel.displayName">
                          {{ certLevel.displayName }} ({{ certLevel.count }})
                        </label>
                      </div>
                    }
                  </div>
                }
                }
              </div>
            </div>
          </div>

          <!-- Right Column -->
          <div class="col-12 col-lg-9" style="flex: 1 1 auto;">
            <div class="form-section" style="width: 90%; padding: 0;">
              <!-- Tabs -->
              <div class="d-flex border-bottom">
                <button
                  type="button"
                  class="main-tab-button"
                  [class.active]="activeMainTab() === 'public'"
                  (click)="setActiveMainTab('public')"
                >
                  Public Catalog
                </button>
                <button
                  type="button"
                  class="main-tab-button"
                  [class.active]="activeMainTab() === 'local'"
                  (click)="setActiveMainTab('local')"
                >
                  Local
                </button>
              </div>

              <!-- Tab Content -->
              <div style="padding: 1.5rem;">
                @if (activeMainTab() === 'public') {
                  <!-- Search Bar -->
                  <div class="mb-3">
                    <div class="input-group">
                      <span class="input-group-text bg-white border-end-0" style="border-radius: 50px 0 0 50px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                          <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                      </span>
                      <input
                        type="text"
                        class="form-control border-start-0"
                        placeholder="Search for integrations..."
                        [value]="searchQuery()"
                        (input)="onSearchChange($event)"
                        style="border-radius: 0 50px 50px 0;"
                      />
                    </div>
                  </div>

                  <!-- Filter Information -->
                  <div class="mb-3 d-flex flex-wrap align-items-center gap-2" style="font-size: 0.9rem;">
                    <span class="text-muted">Showing <strong>{{ filteredApplications().length }}</strong> integrations</span>
                    @if (hasActiveFilters()) {
                      <span class="text-muted">‚Ä¢</span>
                      <span class="text-muted">Filter(s) applied:</span>
                      @if (selectedSupportedOperations().length > 0) {
                        <span class="badge d-flex align-items-center gap-2" style="background-color: #cfe2ff; color: #000; font-size: 0.9rem; font-weight: normal;">
                          <span><strong>Operations:</strong> {{ selectedSupportedOperations().join(', ') }}</span>
                          <button type="button" class="btn-close" (click)="removeOperationsFilter()" style="font-size: 0.75rem;" aria-label="Remove filter"></button>
                        </span>
                      }
                      @if (selectedCategories().length > 0) {
                        <span class="badge d-flex align-items-center gap-2" style="background-color: #cfe2ff; color: #000; font-size: 0.9rem; font-weight: normal;">
                          <span><strong>Category:</strong> {{ selectedCategories().join(', ') }}</span>
                          <button type="button" class="btn-close" (click)="removeCategoryFilter()" style="font-size: 0.75rem;" aria-label="Remove filter"></button>
                        </span>
                      }
                      @if (selectedCertificationLevels().length > 0) {
                        <span class="badge d-flex align-items-center gap-2" style="background-color: #cfe2ff; color: #000; font-size: 0.9rem; font-weight: normal;">
                          <span><strong>Certification:</strong> {{ selectedCertificationLevels().join(', ') }}</span>
                          <button type="button" class="btn-close" (click)="removeCertificationFilter()" style="font-size: 0.75rem;" aria-label="Remove filter"></button>
                        </span>
                      }
                    }
                  </div>

                  <!-- Sort and View Controls -->
                  <div class="mb-4 d-flex align-items-center justify-content-between gap-3">
                    <div class="d-flex align-items-center gap-3">
                      <div class="d-flex align-items-center gap-2">
                        <label class="mb-0 text-muted text-nowrap">Sort by</label>
                        <select class="form-select form-select-sm" [value]="sortBy()" (change)="onSortChange($event)">
                          <option value="alphabetical">Alphabetical</option>
                          <option value="popularity">Popularity</option>
                          <option value="activity">Activity</option>
                        </select>
                      </div>

                      <div class="d-flex align-items-center gap-2">
                        <button type="button" class="btn btn-link p-0" (click)="toggleShowUnsupported()" style="border: none;">
                          @if (showUnsupported()) {
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-on" viewBox="0 0 16 16" style="color: #0d6efd;">
                              <path d="M5 3a5 5 0 0 0 0 10h6a5 5 0 0 0 0-10zm6 9a4 4 0 1 1 0-8 4 4 0 0 1 0 8"/>
                            </svg>
                          } @else {
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-off" viewBox="0 0 16 16" style="color: #6c757d;">
                              <path d="M11 4a4 4 0 0 1 0 8H8a5 5 0 0 0 2-4 5 5 0 0 0-2-4zm-6 8a4 4 0 1 1 0-8 4 4 0 0 1 0 8M0 8a5 5 0 0 0 5 5h6a5 5 0 0 0 0-10H5a5 5 0 0 0-5 5"/>
                            </svg>
                          }
                        </button>
                        <span class="text-muted">Show unsupported</span>
                        <button type="button" class="btn btn-link p-0" style="border: none;" title="Information about unsupported integrations">
                          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                          </svg>
                        </button>
                      </div>
                    </div>

                    <div class="btn-group" role="group">
                      <button
                        type="button"
                        class="btn btn-sm"
                        [style.background-color]="viewMode() === 'grid' ? '#e9ecef' : '#adb5bd'"
                        [style.border-color]="viewMode() === 'grid' ? '#dee2e6' : '#adb5bd'"
                        (click)="setViewMode('grid')"
                        title="Grid view"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-grid" viewBox="0 0 16 16" [style.color]="viewMode() === 'grid' ? '#212529' : '#495057'">
                          <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
                        </svg>
                      </button>
                      <button
                        type="button"
                        class="btn btn-sm"
                        [style.background-color]="viewMode() === 'list' ? '#e9ecef' : '#adb5bd'"
                        [style.border-color]="viewMode() === 'list' ? '#dee2e6' : '#adb5bd'"
                        (click)="setViewMode('list')"
                        title="List view"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="bi bi-list-task" viewBox="0 0 16 16" [style.color]="viewMode() === 'list' ? '#212529' : '#495057'">
                          <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
                          <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
                          <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
                        </svg>
                      </button>
                    </div>
                  </div>

                  <div style="background-color: #f8f9fa; min-height: 400px; padding: 2rem; border-radius: 8px;">
                    @if (loading()) {
                      <div class="d-flex justify-content-center my-5">
                        <div class="spinner-border text-primary" role="status">
                          <span class="visually-hidden">Loading...</span>
                        </div>
                      </div>
                    }

                    @if (error()) {
                      <div class="alert alert-danger" role="alert">{{ error() }}</div>
                    }

                    @if (!loading() && !error()) {
                      @if (filteredApplications().length === 0) {
                      <div class="d-flex flex-column align-items-center justify-content-center my-5 py-5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" fill="currentColor" class="bi bi-puzzle text-muted mb-3" viewBox="0 0 16 16">
                          <path d="M3.112 3.645A1.5 1.5 0 0 1 4.605 2H7a.5.5 0 0 1 .5.5v.382c0 .696-.497 1.182-.872 1.469a.5.5 0 0 0-.115.118l-.012.025L6.5 4.5v.003l.003.01q.005.015.036.053a.9.9 0 0 0 .27.194C7.09 4.9 7.51 5 8 5q.51 0 .91-.14a.9.9 0 0 0 .27-.194.2.2 0 0 0 .036-.054l.003-.01v-.008a.5.5 0 0 0-.121-.147c-.375-.287-.872-.773-.872-1.469V2.5A.5.5 0 0 1 9 2h2.395a1.5 1.5 0 0 1 1.493 1.645L12.645 6.5h.237c.195 0 .42-.147.675-.48.21-.274.528-.52.943-.52.568 0 .947.447 1.154.862C15.877 6.807 16 7.387 16 8s-.123 1.193-.346 1.638c-.207.415-.586.862-1.154.862-.415 0-.733-.246-.943-.52-.255-.333-.48-.48-.675-.48h-.237l.243 2.855A1.5 1.5 0 0 1 11.395 14H9a.5.5 0 0 1-.5-.5v-.382c0-.696.497-1.182.872-1.469a.5.5 0 0 0 .115-.118l.012-.025.001-.006v-.003a.2.2 0 0 0-.039-.064.9.9 0 0 0-.27-.193C8.91 11.1 8.49 11 8 11s-.91.1-1.19.24a.9.9 0 0 0-.271.194.2.2 0 0 0-.039.063v.003l.001.006.012.025c.016.027.05.068.115.118.375.287.872.773.872 1.469v.382a.5.5 0 0 1-.5.5H4.605a1.5 1.5 0 0 1-1.493-1.645L3.356 9.5h-.238c-.195 0-.42.147-.675.48-.21.274-.528.52-.943.52-.568 0-.947-.447-1.154-.862C.123 9.193 0 8.613 0 8s.123-1.193.346-1.638C.553 5.947.932 5.5 1.5 5.5c.415 0 .733.246.943.52.255.333.48.48.675.48h.238zM4.605 3a.5.5 0 0 0-.498.55l.001.007.29 3.4A.5.5 0 0 1 3.9 7.5h-.782c-.696 0-1.182-.497-1.469-.872a.5.5 0 0 0-.118-.115l-.025-.012L1.5 6.5h-.003a.2.2 0 0 0-.064.039.9.9 0 0 0-.193.27C1.1 7.09 1 7.51 1 8s.1.91.24 1.19c.07.14.14.225.194.271a.2.2 0 0 0 .063.039H1.5l.006-.001.025-.012a.5.5 0 0 0 .118-.115c.287-.375.773-.872 1.469-.872H3.9a.5.5 0 0 1 .498.542l-.29 3.408a.5.5 0 0 0 .497.55h1.878c-.048-.166-.195-.352-.463-.557-.274-.21-.52-.528-.52-.943 0-.568.447-.947.862-1.154C6.807 10.123 7.387 10 8 10s1.193.123 1.638.346c.415.207.862.586.862 1.154 0 .415-.246.733-.52.943-.268.205-.415.39-.463.557h1.878a.5.5 0 0 0 .498-.55l-.001-.007-.29-3.4A.5.5 0 0 1 12.1 8.5h.782c.696 0 1.182.497 1.469.872.05.065.091.099.118.115l.025.012.006.001h.003a.2.2 0 0 0 .064-.039.9.9 0 0 0 .193-.27c.14-.28.24-.7.24-1.191s-.1-.91-.24-1.19a.9.9 0 0 0-.194-.271.2.2 0 0 0-.063-.039H14.5l-.006.001-.025.012a.5.5 0 0 0-.118.115c-.287.375-.773.872-1.469.872H12.1a.5.5 0 0 1-.498-.543l.29-3.407a.5.5 0 0 0-.497-.55H9.517c.048.166.195.352.463.557.274.21.52.528.52.943 0 .568-.447.947-.862 1.154C9.193 5.877 8.613 6 8 6s-1.193-.123-1.638-.346C5.947 5.447 5.5 5.068 5.5 4.5c0-.415.246-.733.52-.943.268-.205.415-.39.463-.557z"/>
                        </svg>
                        <p class="text-muted fs-5 mb-4">No integrations found.</p>
                        <div class="d-flex gap-3">
                          <button type="button" class="btn" style="background-color: #fff; color: #000; border: 1px solid #dee2e6;" (click)="setActiveMainTab('local')">
                            Show Local Connectors
                          </button>
                          <button type="button" class="btn" style="background-color: #0d6efd; color: #fff;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-stars me-2" viewBox="0 0 16 16">
                              <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.73 1.73 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.73 1.73 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.73 1.73 0 0 0 3.407 2.31zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z"/>
                            </svg>
                            Create New Connector with AI
                          </button>
                        </div>
                      </div>
                    } @else {
                      @if (viewMode() === 'grid') {
                        <div class="row g-3">
                          @for (app of filteredApplications(); track app.id) {
                            <div class="col-12 col-md-6 col-lg-4">
                              <div class="card h-100 shadow-sm">
                                <img [src]="app.logo" alt="" class="p-3" style="width: 90px; height: 90px; object-fit: contain;" />
                                <div class="card-body d-flex flex-column">
                                  <h5 class="card-title">{{ app.displayName }}</h5>
                                  @if (app.lifecycleState && !app.pendingRequest) {
                                    <span class="badge mb-2 align-self-start" style="background-color: #d4edda; color: #155724;">{{ formatLifecycleState(app.lifecycleState) }}</span>
                                  }
                                  <p class="card-text text-muted small flex-grow-1">{{ app.description }}</p>
                                </div>
                              </div>
                            </div>
                          }
                        </div>
                      }

                      @if (viewMode() === 'list') {
                        <div class="mb-4">
                          @for (app of filteredApplications(); track app.id) {
                            <div class="card mb-3 shadow-sm">
                              <div class="card-body">
                                <div class="row align-items-center">
                                  <div class="col-auto">
                                    <img [src]="app.logo" alt="" class="img-fluid" style="width: 48px; height: 48px; object-fit: contain;" />
                                  </div>
                                  <div class="col">
                                    <h5 class="card-title mb-1">{{ app.displayName }}</h5>
                                    @if (app.lifecycleState && !app.pendingRequest) {
                                      <span class="badge mb-2" style="background-color: #d4edda; color: #155724;">{{ formatLifecycleState(app.lifecycleState) }}</span>
                                    }
                                    <p class="card-text text-muted mb-0">{{ app.description }}</p>
                                  </div>
                                </div>
                              </div>
                            </div>
                          }
                        </div>
                      }
                    }
                    }
                  </div>

                  <!-- Separator Line -->
                  <hr style="border: 0; border-top: 2px solid #adb5bd; margin: 2rem 0;">

                  <!-- Custom Integration Section -->
                  <div class="text-center mb-4">
                    <p class="mb-2">
                      Need a custom integration?
                      <button type="button" class="btn btn-link p-0 align-baseline" style="color: #0d6efd; text-decoration: none; font-size: inherit;" (click)="openRequestModal()">Request a tailored solution</button>
                      that fits your needs.
                    </p>
                    <p class="mb-0">You can also import if it's ready.</p>
                  </div>
                } @else {
                  <p>Local content goes here</p>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Request Tailored Solution Modal -->
@if (isRequestModalOpen()) {
  <div class="modal-backdrop" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1040;" (click)="closeRequestModal()"></div>
  <div class="modal" style="display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1050; overflow: auto;">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 600px; margin: auto;">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header" style="border-bottom: 1px solid #dee2e6; padding: 1rem 1.5rem;">
          <h6 class="modal-title mb-0">Request Tailored Solution</h6>
          <button type="button" class="btn-close" (click)="closeRequestModal()" aria-label="Close"></button>
        </div>
        <div class="modal-body" style="padding: 1.5rem;">
          <!-- Row 1 -->
          <h6 class="mb-2">Didn't find the integration you need?</h6>

          <!-- Row 2 -->
          <p class="text-muted mb-4">Tell us what you're looking for and we'll help you connect it.</p>

          <!-- Row 3 & 4 -->
          <div class="mb-3">
            <label class="form-label">
              Integration Application Name*
              <button type="button" class="btn btn-link p-0 ms-1" style="border: none;" title="Application name information">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                </svg>
              </button>
            </label>
            <input type="text" class="form-control" [(ngModel)]="formData.integrationApplicationName" required>
          </div>

          <!-- Row 5 -->
          <div class="mb-3">
            <label class="form-label">
              Base URL Application (Optional)
              <button type="button" class="btn btn-link p-0 ms-1" style="border: none;" title="Base URL information">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                </svg>
              </button>
            </label>
            <input type="url" class="form-control" [(ngModel)]="formData.baseUrl">
          </div>

          <!-- Row 6 & 7 -->
          <div class="mb-3">
            <label class="form-label">
              Requested Capabilities
              <button type="button" class="btn btn-link p-0 ms-1" style="border: none;" title="Capabilities information">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                </svg>
              </button>
            </label>

            <!-- Custom dropdown field -->
            <div class="position-relative">
              <div class="form-control d-flex flex-wrap align-items-center gap-1"
                   (click)="toggleCapabilitiesDropdown()"
                   style="min-height: 38px; cursor: pointer; padding: 0.375rem 2.25rem 0.375rem 0.75rem;">

                @if (selectedCapabilities().length === 0) {
                  <span style="color: #6c757d;">Select</span>
                } @else {
                  @for (capability of selectedCapabilities(); track capability) {
                    <span class="badge" style="background-color: #cfe2ff; color: black; font-size: 0.875rem;">
                      {{ capability }}
                      <button type="button" class="btn-close btn-close-sm ms-1" (click)="removeCapability(capability, $event)"
                              style="font-size: 0.75rem; vertical-align: middle;" aria-label="Remove"></button>
                    </span>
                  }
                }

                <!-- Dropdown arrow -->
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                     class="bi position-absolute top-50 end-0 translate-middle-y me-2"
                     [style.transform]="isCapabilitiesDropdownOpen() ? 'translateY(-50%) rotate(180deg)' : 'translateY(-50%)'"
                     style="transition: transform 0.2s;" viewBox="0 0 16 16">
                  <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708"/>
                </svg>
              </div>

              <!-- Dropdown menu with checkboxes -->
              @if (isCapabilitiesDropdownOpen()) {
                <div class="position-absolute w-100 border rounded bg-white shadow-sm mt-1"
                     style="z-index: 1000; max-height: 300px; overflow-y: auto;">
                  <div class="p-3" style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-paged-search" (change)="onCapabilityChange($event, 'Paged Search')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Paged Search</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-live-sync" (change)="onCapabilityChange($event, 'Live Sync')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Live Sync</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-read-access" (change)="onCapabilityChange($event, 'Read Access')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Read Access</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-update-data" (change)="onCapabilityChange($event, 'Update Data')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Update Data</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-create-entry" (change)="onCapabilityChange($event, 'Create Entry')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Create Entry</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-test-connection" (change)="onCapabilityChange($event, 'Test Connection')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Test Connection</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-auxiliary-object-classes" (change)="onCapabilityChange($event, 'Auxiliary Object Classes')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Auxiliary Object Classes</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-script-execution" (change)="onCapabilityChange($event, 'Script Execution')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Script Execution</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-password-security" (change)="onCapabilityChange($event, 'Password Security')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>Password Security</span>
                    </label>
                    <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
                      <input class="me-2" type="checkbox" id="capability-user-credentials" (change)="onCapabilityChange($event, 'User Credentials')"
                             style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
                      <span>User Credentials</span>
                    </label>
                  </div>

                  <!-- Close button -->
                  <div class="border-top p-2 text-end">
                    <button type="button" class="btn btn-sm btn-primary" (click)="closeCapabilitiesDropdown()">Done</button>
                  </div>
                </div>
              }
            </div>
          </div>

          <!-- Row 8 & 9 -->
          <div class="mb-3">
            <label class="form-label">Short description*</label>
            <textarea class="form-control" rows="3" [(ngModel)]="formData.description" placeholder="Briefly describe the integration you need and your use case." required></textarea>
          </div>

          <!-- Row 10 & 11 -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label class="form-label">
                System Version (Optional)
                <button type="button" class="btn btn-link p-0 ms-1" style="border: none;" title="System version information">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                  </svg>
                </button>
              </label>
              <input type="text" class="form-control" [(ngModel)]="formData.systemVersion">
            </div>
            <div class="col-md-6">
              <label class="form-label">
                Your Contact Email (Optional)
                <button type="button" class="btn btn-link p-0 ms-1" style="border: none;" title="Contact email information">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16" style="color: #6ea8fe;">
                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                  </svg>
                </button>
              </label>
              <input type="email" class="form-control" [(ngModel)]="formData.email">
            </div>
          </div>

          <!-- Row 12 -->
          <div class="mb-3">
            <label class="d-flex align-items-center" style="cursor: pointer; margin-bottom: 0;">
              <input class="me-2" type="checkbox" id="collaborateCheckbox" [(ngModel)]="formData.collab"
                     style="width: 18px; height: 18px; cursor: pointer; flex-shrink: 0;">
              <span>I'm open to collaborate with the community</span>
            </label>
          </div>

          <!-- Row 13 -->
          <hr style="border: 0; border-top: 1px solid #adb5bd; margin: 1rem -1.5rem;">

          <!-- Error Message -->
          @if (submitError()) {
            <div class="alert alert-danger mb-3" role="alert">
              {{ submitError() }}
            </div>
          }

          <!-- Row 14 -->
          <div class="d-flex justify-content-between">
            <button type="button" class="btn" style="color: #0d6efd; background-color: #fff; border: none;" (click)="closeRequestModal()" [disabled]="isSubmitting()">Cancel</button>
            <button type="button" class="btn" style="color: #fff; background-color: #0d6efd;" (click)="submitRequest()" [disabled]="isSubmitting() || !formData.integrationApplicationName || !formData.description">
              {{ isSubmitting() ? 'Submitting...' : 'Submit Request' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
}
