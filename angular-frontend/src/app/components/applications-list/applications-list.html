<div class="container-fluid py-4">
  <div class="text-center mb-5">
    <h1 class="display-4 fw-bold mb-3">Integration Catalog</h1>
    <p class="lead text-muted">Easily connect any application or system to midpoint</p>
  </div>

  <div class="text-center mb-4">
    <p class="text-muted">Explore available integrations to jump-start your workflow, build your own AI-guided assistance,</p>
    <p class="text-muted">or upload an existing configuration to get started in just minutes. The process is fast, flexible, and user-friendly.</p>
  </div>

  <div class="row mb-4">
    <div class="col-lg-8 mx-auto">
      <div class="input-group input-group-lg">
        <span class="input-group-text bg-white">üîç</span>
        <input
          type="text"
          class="form-control"
          placeholder="Search for integrations..."
          [value]="searchQuery()"
          (input)="onSearchChange($event)"
        />
        <button class="btn btn-outline-secondary" type="button" title="Filter">
          ‚öô
        </button>
      </div>
    </div>
  </div>

  <h2 class="h3 mb-4">Featured integration apps</h2>

  @if (loading()) {
    <div class="d-flex justify-content-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>
  }

  @if (error()) {
    <div class="alert alert-danger" role="alert">{{ error() }}</div>
  }

  @if (!loading() && !error()) {
    <div class="position-relative mb-5">
      <button class="btn btn-light position-absolute top-50 start-0 translate-middle-y"
              style="z-index: 10;"
              (click)="scrollLeft()"
              [disabled]="!canScrollLeft()">
        ‚Üê
      </button>

      <div class="overflow-auto" #scrollContainer (scroll)="onScroll()" style="scroll-behavior: smooth;">
        <div class="d-flex gap-3 px-5">
          @for (app of featuredApplications(); track app.id) {
            <div class="card" style="min-width: 250px; max-width: 250px;">
              <img [src]="app.logo" [alt]="app.displayName" class="card-img-top p-3" style="height: 150px; object-fit: contain;" />
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ app.displayName }}</h5>
                @if (app.lifecycleState) {
                  <span class="badge bg-success mb-2 align-self-start">{{ app.lifecycleState }}</span>
                }
                <p class="card-text text-muted small flex-grow-1">{{ app.description }}</p>
                <button class="btn btn-primary btn-sm mt-2" (click)="navigateToDetail(app.id)">View Details</button>
              </div>
            </div>
          }
        </div>
      </div>

      <button class="btn btn-light position-absolute top-50 end-0 translate-middle-y"
              style="z-index: 10;"
              (click)="scrollRight()"
              [disabled]="!canScrollRight()">
        ‚Üí
      </button>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h2 class="h3 mb-1">More apps</h2>
        <p class="text-muted mb-0">Showing {{ filteredCount() }} integrations</p>
      </div>
      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center gap-2">
          <label class="mb-0 text-muted">Sorted by:</label>
          <select class="form-select form-select-sm" [value]="sortBy()" (change)="onSortChange($event)">
            <option value="alphabetical">Alphabetical</option>
          </select>
        </div>

        <div class="btn-group" role="group">
          <button
            type="button"
            class="btn btn-sm"
            [class.btn-primary]="viewMode() === 'grid'"
            [class.btn-outline-secondary]="viewMode() !== 'grid'"
            (click)="setViewMode('grid')"
            title="Grid view"
          >
            ‚äû
          </button>
          <button
            type="button"
            class="btn btn-sm"
            [class.btn-primary]="viewMode() === 'list'"
            [class.btn-outline-secondary]="viewMode() !== 'list'"
            (click)="setViewMode('list')"
            title="List view"
          >
            ‚ò∞
          </button>
        </div>
      </div>
    </div>

    @if (viewMode() === 'grid') {
      <div class="row g-4 mb-4">
        @for (app of moreApplications(); track app.id) {
          <div class="col-12 col-sm-6 col-md-4 col-lg-3">
            <div class="card h-100 shadow-sm">
              <img [src]="app.logo" [alt]="app.displayName" class="card-img-top p-3" style="height: 150px; object-fit: contain;" />
              <div class="card-body d-flex flex-column">
                <h5 class="card-title">{{ app.displayName }}</h5>
                @if (app.lifecycleState) {
                  <span class="badge bg-success mb-2 align-self-start">{{ app.lifecycleState }}</span>
                }
                <p class="card-text text-muted small flex-grow-1">{{ app.description }}</p>
                <button class="btn btn-primary btn-sm mt-2" (click)="navigateToDetail(app.id)">View Details</button>
              </div>
            </div>
          </div>
        }
      </div>
    }

    @if (viewMode() === 'list') {
      <div class="mb-4">
        @for (app of moreApplications(); track app.id) {
          <div class="card mb-3 shadow-sm">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-auto">
                  <img [src]="app.logo" [alt]="app.displayName" class="img-fluid" style="width: 80px; height: 80px; object-fit: contain;" />
                </div>
                <div class="col">
                  <h5 class="card-title mb-1">{{ app.displayName }}</h5>
                  @if (app.lifecycleState) {
                    <span class="badge bg-success mb-2">{{ app.lifecycleState }}</span>
                  }
                  <p class="card-text text-muted mb-0">{{ app.description }}</p>
                </div>
                <div class="col-auto">
                  <button class="btn btn-primary" (click)="navigateToDetail(app.id)">View Details</button>
                </div>
              </div>
            </div>
          </div>
        }
      </div>
    }

    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage() === 0">
          <button class="page-link" (click)="previousPage()" [disabled]="currentPage() === 0">
            ‚Üê Previous
          </button>
        </li>

        @for (page of [].constructor(totalPages()); track $index) {
          <li class="page-item" [class.active]="currentPage() === $index">
            <button class="page-link" (click)="goToPage($index)">
              {{ $index + 1 }}
            </button>
          </li>
        }

        <li class="page-item" [class.disabled]="currentPage() === totalPages() - 1">
          <button class="page-link" (click)="nextPage()" [disabled]="currentPage() === totalPages() - 1">
            Next ‚Üí
          </button>
        </li>
      </ul>
    </nav>
  }
</div>
